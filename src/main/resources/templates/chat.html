<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>–ß–∞—Ç –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</title>
    <script th:inline="javascript">
        /*<![CDATA[*/
        document.addEventListener('DOMContentLoaded', function() {
            // –ü–æ–ª—É—á–∞–µ–º —Ç–æ–∫–µ–Ω –∏–∑ URL –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º
            const urlParams = new URLSearchParams(window.location.search);
            const token = urlParams.get('token');
            if (token) {
                localStorage.setItem('token', token);
            }

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
            if (!localStorage.getItem('token')) {
                window.location.href = '/login';
            }
        });
        /*]]>*/
    </script>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
<div class="chat-container">
    <div class="sidebar">
        <div class="header">
            <h2>–ß–∞—Ç—ã</h2>
            <button id="newChatBtn">–ù–æ–≤—ã–π —á–∞—Ç</button>
        </div>
        <div id="chatList" class="chat-list">
            <!-- Chats will be loaded here -->
        </div>
    </div>
    <div class="main">
        <div id="chatHeader" class="chat-header">
            <div class="chat-header-left">
                <h2 id="chatTitle">–í—ã–±–µ—Ä–µ—Ç–µ —á–∞—Ç</h2>
                <span class="participants-count" id="participantsCount" style="display: none; cursor: pointer;">
                    –£—á–∞—Å—Ç–Ω–∏–∫–∏: <span id="participantsNumber"></span>
                </span>
                <button id="addUserBtn" class="add-user-btn" style="display: none;">–î–æ–±–∞–≤–∏—Ç—å</button>
            </div>
            <button id="logoutBtn" class="logout-btn">–í—ã–π—Ç–∏</button>
        </div>
        <div id="messages" class="messages">
            <!-- Messages will be loaded here -->
        </div>
        <div class="message-input">
            <input type="text" id="messageInput" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ...">
            <label for="fileInput" style="cursor:pointer; margin-right: 10px;">üìé</label>
            <input type="file" id="fileInput" style="display:none;" />

            <button id="sendButton">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        </div>
    </div>
</div>

<div id="newChatModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2>–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —á–∞—Ç</h2>
        <div class="modal-body">
            <!--<div class="form-group">
                <label for="chatName">Chat Name:</label>
                <input type="text" id="chatName" class="form-control" placeholder="Enter chat name">
            </div>
            <div class="form-group">
                <label for="participantSearch">Participant:</label>
                <input type="text" id="participantSearch" class="form-control" placeholder="Search user">
                <div id="searchResults" class="search-results"></div>
            </div>-->
            <div class="form-group">
                <label class="checkbox-label">
                    <input type="checkbox" id="isGroupChat"/>
                    <span>–°–æ–∑–¥–∞—Ç—å –≥—Ä—É–ø–ø–æ–≤–æ–π —á–∞—Ç</span>
                </label>
            </div>

            <div class="form-group group-chat-only" style="display: none;">
                <label for="chatName">–ù–∞–∑–≤–∞–Ω–∏–µ:</label>
                <input type="text" id="chatName" class="form-control" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ...">
            </div>

            <div class="form-group">
                <label for="participantSearch">–£—á–∞—Å—Ç–Ω–∏–∫–∏:</label>
                <input type="text" id="participantSearch" class="form-control" placeholder="–ù–∞–π—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">
                <div id="searchResults" class="search-results"></div>
                <div id="selectedParticipants" class="selected-participants"></div>
            </div>

            <button id="createChatBtn" class="btn-primary">–°–æ–∑–¥–∞—Ç—å —á–∞—Ç</button>
        </div>
    </div>
</div>

<div id="addUserModal" class="modal">
    <div class="modal-content">
        <span class="close-add">&times;</span>
        <h2>–î–æ–±–∞–≤–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</h2>
        <div class="form-group">
            <label for="addParticipantSearch">–ù–∞–π—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</label>
            <input type="text" id="addParticipantSearch" class="form-control" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è">
            <div id="addSearchResults" class="search-results"></div>
        </div>
        <div id="addSelectedParticipants" class="selected-participants"></div>
        <button id="addUsersToChatBtn" class="btn-primary">–î–æ–±–∞–≤–∏—Ç—å</button>
    </div>
</div>

<div id="viewParticipantsModal" class="modal">
    <div class="modal-content">
        <span class="close-participants">&times;</span>
        <h2>–£—á–∞—Å—Ç–Ω–∏–∫–∏ —á–∞—Ç–∞</h2>
        <ul id="participantsList" class="participants-list"></ul>
    </div>
</div>



<script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
<script src="/js/chat.js"></script>
</body>
</html>