<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Admin Panel</title>
  <link rel="stylesheet" href="/css/style.css">
  <style>
    body {
      font-family: sans-serif;
      margin: 20px;
    }

    h1 {
      margin-bottom: 30px;
    }

    .section {
      margin-bottom: 40px;
    }

    .logout-btn {
      float: right;
      padding: 6px 12px;
      background-color: #c0392b;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    .logout-btn:hover {
      background-color: #e74c3c;
    }

    ul {
      list-style: none;
      padding: 0;
      margin-top: 15px;
    }

    .list-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 15px;
      border: 1px solid #ddd;
      border-radius: 6px;
      margin-bottom: 10px;
      background-color: #f9f9f9;
      word-break: break-word;
    }

    .list-item span {
      flex: 1;
      margin-right: 10px;
    }

    .list-item button {
      padding: 5px 10px;
      background-color: #e67e22;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      white-space: nowrap;
    }

    .list-item button:hover {
      background-color: #d35400;
    }
  </style>
</head>
<body>
<h1>Админ-панель</h1>
<button id="logoutBtn" class="logout-btn">Выйти</button>
<div class="section">
  <div>
    <h2>Чаты</h2>
  </div>
  <ul id="chatList"></ul>
</div>

<div class="section">
  <h2>Пользователи</h2>
  <ul id="userList"></ul>
</div>

<script src="/js/admin.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    fetch('/api/admin/chats')
            .then(res => res.json())
            .then(chats => {
              const list = document.getElementById('chatList');
              console.log(list);
              chats.forEach(chat => {
                const li = document.createElement('li');
                li.className = 'list-item';
                const span = document.createElement('span');
                if (chat.name.trim() === '') {
                  const participantNames = chat.participants
                          .map(p => p.name || p.username)
                          .join(', ');
                  span.textContent = `Chat ${chat.id} - ${participantNames}`;
                } else {
                  span.textContent = `Chat ${chat.id} - ${chat.name || "No name"}`;
                }

                const btn = document.createElement('button');
                btn.textContent = "Удалить";
                btn.onclick = () => {
                  fetch(`/api/admin/chats/${chat.id}`, { method: 'DELETE' })
                          .then(() => li.remove());
                };

                li.appendChild(span);
                li.appendChild(btn);
                list.appendChild(li);
              });
            });

    fetch('/api/admin/users')
            .then(res => res.json())
            .then(users => {
              const list = document.getElementById('userList');
              users.forEach(user => {
                const li = document.createElement('li');
                li.className = 'list-item';

                const span = document.createElement('span');
                span.textContent = "id:" + user.id + "   " + "username:" + user.username + "   " + "name:" + user.name;

                const btn = document.createElement('button');
                btn.textContent = "Удалить";
                btn.onclick = () => {
                  fetch(`/api/admin/users/${user.id}`, { method: 'DELETE' })
                          .then(() => li.remove());
                };

                li.appendChild(span);
                li.appendChild(btn);
                list.appendChild(li);
              });
            });
  });
</script>
</body>
</html>
